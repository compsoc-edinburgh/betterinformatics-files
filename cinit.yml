programs:
  - name: migrate
    path: /usr/bin/python3
    args:
      - "manage.py"
      - "migrate"
    workdir: /app
    user: app-user
    group: app-user
    before:
      - gunicorn
    env:
      - DEPLOYMENT_DOMAIN:
      - RUNTIME_SERVIS_PEOPLE_API_SERVER:
      - RUNTIME_SERVIS_PEOPLE_API_PORT:
      - RUNTIME_SERVIS_PEOPLE_API_KEY:
      - RUNTIME_MINIO_SERVER:
      - RUNTIME_MINIO_ACCESS_KEY:
      - RUNTIME_MINIO_SECRET_KEY:
      - RUNTIME_MINIO_BUCKET_NAME:
      - RUNTIME_POSTGRES_DB_SERVER:
      - RUNTIME_POSTGRES_DB_PORT:
      - RUNTIME_POSTGRES_DB_NAME:
      - RUNTIME_POSTGRES_DB_USER:
      - RUNTIME_POSTGRES_DB_PW:
      - RUNTIME_COMMUNITY_SOLUTIONS_SESSION_SECRET:
      - RUNTIME_COMMUNITY_SOLUTIONS_API_KEY:
      - RUNTIME_FRONTEND_GLOB_ID:
      - RUNTIME_FRONTEND_KEYCLOAK_URL:
      - RUNTIME_FRONTEND_KEYCLOAK_REALM:
      - RUNTIME_FRONTEND_KEYCLOAK_CLIENT_ID:
      - RUNTIME_JWT_PUBLIC_KEY:
      - RUNTIME_JWT_VERIFY_SIGNATURE:
      - RUNTIME_JWT_RESOURCE_GROUP:
  - name: gunicorn
    path: /usr/local/bin/gunicorn
    args:
      - "backend.wsgi"
      - "-b"
      - "0.0.0.0:80"
      - "-w"
      - "4"
      - "--worker-tmp-dir"
      - "/dev/shm"
      - "--log-level"
      - "debug"
    workdir: /app
    user: app-user
    group: app-user
    capabilities:
      - CAP_NET_BIND_SERVICE
    env:
      - DEPLOYMENT_DOMAIN:
      - RUNTIME_MINIO_SERVER:
      - RUNTIME_MINIO_ACCESS_KEY:
      - RUNTIME_MINIO_SECRET_KEY:
      - RUNTIME_MINIO_BUCKET_NAME:
      - RUNTIME_POSTGRES_DB_SERVER:
      - RUNTIME_POSTGRES_DB_PORT:
      - RUNTIME_POSTGRES_DB_NAME:
      - RUNTIME_POSTGRES_DB_USER:
      - RUNTIME_POSTGRES_DB_PW:
      - RUNTIME_COMMUNITY_SOLUTIONS_SESSION_SECRET:
      - RUNTIME_COMMUNITY_SOLUTIONS_API_KEY:
      - RUNTIME_FRONTEND_GLOB_ID:
      - RUNTIME_FRONTEND_KEYCLOAK_URL:
      - RUNTIME_FRONTEND_KEYCLOAK_REALM:
      - RUNTIME_FRONTEND_KEYCLOAK_CLIENT_ID:
      - RUNTIME_JWT_PUBLIC_KEY:
      - RUNTIME_JWT_VERIFY_SIGNATURE:
      - RUNTIME_JWT_RESOURCE_GROUP:
